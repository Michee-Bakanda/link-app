{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useContext, useEffect, useState } from \"react\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport { AuthContext } from \"../context/auth\";\nimport FooterTabs from \"../components/nav/FooterTabs\";\nimport { LinkContext } from \"../context/link\";\nimport axios from \"axios\";\nimport PreviewCard from \"../components/links/PreviewCard\";\nimport SubmitButton from \"../components/auth/SubmitButton\";\nimport Search from \"../components/links/Search\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nvar Home = function Home(_ref) {\n  var navigation = _ref.navigation;\n\n  var _useContext = useContext(AuthContext),\n      _useContext2 = _slicedToArray(_useContext, 2),\n      state = _useContext2[0],\n      setState = _useContext2[1];\n\n  var _useContext3 = useContext(LinkContext),\n      _useContext4 = _slicedToArray(_useContext3, 2),\n      links = _useContext4[0],\n      setLinks = _useContext4[1];\n\n  var _useState = useState(1),\n      _useState2 = _slicedToArray(_useState, 2),\n      page = _useState2[0],\n      setPage = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      linksCount = _useState4[0],\n      setLinksCount = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      keyword = _useState6[0],\n      setKeyword = _useState6[1];\n\n  useEffect(function () {\n    fetchLinks();\n  }, [page]);\n\n  var fetchLinks = function fetchLinks() {\n    var _await$axios$get, data;\n\n    return _regeneratorRuntime.async(function fetchLinks$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(axios.get(\"/links/\" + page));\n\n          case 2:\n            _await$axios$get = _context.sent;\n            data = _await$axios$get.data;\n            setLinks([].concat(_toConsumableArray(links), _toConsumableArray(data)));\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    var linksCount = function linksCount() {\n      var _await$axios$get2, data;\n\n      return _regeneratorRuntime.async(function linksCount$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(axios.get(\"/links-count\"));\n\n            case 2:\n              _await$axios$get2 = _context2.sent;\n              data = _await$axios$get2.data;\n              setLinksCount(data);\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    linksCount();\n  }, []);\n\n  var handlePress = function handlePress(link) {\n    return _regeneratorRuntime.async(function handlePress$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(axios.put(\"/view-count/\" + link._id));\n\n          case 2:\n            navigation.navigate(\"LinkView\", {\n              link: link\n            });\n            setLinks(function () {\n              var index = links.findIndex(function (l) {\n                return l._id === link._id;\n              });\n              links[index] = _objectSpread(_objectSpread({}, link), {}, {\n                views: link.views + 1\n              });\n              return _toConsumableArray(links);\n            });\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var searched = function searched(keyword) {\n    return function (item) {\n      return item.urlPreview.ogTitle.toLowerCase().includes(keyword.toLowerCase());\n    };\n  };\n\n  return _jsxs(_Fragment, {\n    children: [_jsx(Search, {\n      value: keyword,\n      setValue: setKeyword\n    }), _jsxs(SafeAreaView, {\n      style: {\n        flex: 1\n      },\n      children: [_jsx(Text, {\n        style: {\n          paddingTop: 10,\n          paddingBottom: 10,\n          textAlign: \"center\"\n        },\n        children: \"Recent Links\"\n      }), _jsxs(ScrollView, {\n        showsVerticalScrollIndicator: false,\n        children: [links && links.filter(searched(keyword)).map(function (link) {\n          return _jsx(View, {\n            style: {\n              alignItems: \"center\"\n            },\n            children: _jsx(PreviewCard, _objectSpread(_objectSpread({}, link.urlPreview), {}, {\n              handlePress: handlePress,\n              link: link,\n              showIcons: true\n            }))\n          }, link._id);\n        }), linksCount > (links == null ? void 0 : links.length) && _jsx(SubmitButton, {\n          title: \"Load more\",\n          handleSubmit: function handleSubmit() {\n            return setPage(page + 1);\n          }\n        })]\n      }), _jsx(FooterTabs, {})]\n    })]\n  });\n};\n\nexport default Home;","map":{"version":3,"names":["React","useContext","useEffect","useState","AuthContext","FooterTabs","LinkContext","axios","PreviewCard","SubmitButton","Search","Home","navigation","state","setState","links","setLinks","page","setPage","linksCount","setLinksCount","keyword","setKeyword","fetchLinks","get","data","handlePress","link","put","_id","navigate","index","findIndex","l","views","searched","item","urlPreview","ogTitle","toLowerCase","includes","flex","paddingTop","paddingBottom","textAlign","filter","map","alignItems","length"],"sources":["/home/michee/Documents/link/105_loading/client/screens/Home.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\nimport { SafeAreaView, View, ScrollView, TouchableOpacity,Text } from \"react-native\";\n// import Text from \"//@kaloraat/react-native-text\";\nimport { AuthContext } from \"../context/auth\";\nimport FooterTabs from \"../components/nav/FooterTabs\";\nimport { LinkContext } from \"../context/link\";\nimport axios from \"axios\";\nimport PreviewCard from \"../components/links/PreviewCard\";\nimport SubmitButton from \"../components/auth/SubmitButton\";\nimport Search from \"../components/links/Search\";\n\nconst Home = ({ navigation }) => {\n  const [state, setState] = useContext(AuthContext);\n  const [links, setLinks] = useContext(LinkContext);\n  const [page, setPage] = useState(1);\n  const [linksCount, setLinksCount] = useState(0);\n  const [keyword, setKeyword] = useState(\"\");\n\n  useEffect(() => {\n    fetchLinks();\n  }, [page]);\n\n  const fetchLinks = async () => {\n    const { data } = await axios.get(`/links/${page}`);\n    setLinks([...links, ...data]);\n  };\n\n  useEffect(() => {\n    const linksCount = async () => {\n      const { data } = await axios.get(`/links-count`);\n      setLinksCount(data);\n    };\n    linksCount();\n  }, []);\n\n  const handlePress = async (link) => {\n    await axios.put(`/view-count/${link._id}`);\n    navigation.navigate(\"LinkView\", { link });\n    // update link in the context\n    setLinks(() => {\n      const index = links.findIndex((l) => l._id === link._id);\n      links[index] = { ...link, views: link.views + 1 };\n      return [...links];\n    });\n  };\n\n  const searched = (keyword) => (item) => {\n    return item.urlPreview.ogTitle\n      .toLowerCase()\n      .includes(keyword.toLowerCase());\n  };\n\n  return (\n    <>\n      <Search value={keyword} setValue={setKeyword} />\n      <SafeAreaView style={{ flex: 1 }}>\n        <Text  style={{ paddingTop: 10, paddingBottom: 10,textAlign:\"center\" }}>\n          Recent Links\n        </Text>\n\n        <ScrollView showsVerticalScrollIndicator={false}>\n          {links &&\n            links.filter(searched(keyword)).map((link) => (\n              <View\n                key={link._id}\n                style={{\n                  alignItems: \"center\",\n                }}\n              >\n                <PreviewCard\n                  {...link.urlPreview}\n                  handlePress={handlePress}\n                  link={link}\n                  showIcons={true}\n                />\n              </View>\n            ))}\n\n          {linksCount > links?.length && (\n            <SubmitButton\n              title=\"Load more\"\n              handleSubmit={() => setPage(page + 1)}\n            />\n          )}\n        </ScrollView>\n\n        <FooterTabs />\n      </SafeAreaView>\n    </>\n  );\n};\n\nexport default Home;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}